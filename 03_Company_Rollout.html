<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISC Digitalization - Company-Wide Rollout</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #6a6de3;
            --secondary-color: #764ba2;
            --accent-color: #34d399;
            --bg-color: #f4f7fe;
            --text-color: #4a5568;
            --heading-color: #2d3748;
            --card-bg: rgba(255, 255, 255, 0.9);
            --card-border: rgba(255, 255, 255, 0.95);
            --shadow-color: rgba(102, 126, 234, 0.25);
            --free-tier-color: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><g fill="%23e0e7ff" fill-opacity="0.4"><circle cx="50" cy="50" r="4"/></g></svg>');
            height: 100vh;
            overflow: hidden;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--primary-gradient);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            height: 70px;
            z-index: 1000;
            border-bottom: none;
        }
        .navbar .nav-logo,
        .navbar .nav-links a {
            color: white;
            -webkit-text-fill-color: white;
        }
        .nav-logo { font-family: 'Poppins', sans-serif; font-size: 1.5rem; font-weight: 600; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none; }
        .nav-links { list-style: none; display: flex; gap: 40px; }
        .nav-links a {
            text-decoration: none;
            color: white;
            font-weight: 500;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            position: relative;
            padding: 8px 18px;
            border-radius: 20px;
            transition: background-color 0.3s ease;
        }
        .nav-links a:hover, 
        .nav-links a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .nav-links a::after {
            display: none;
        }

        .slides-container { position: relative; width: 100%; height: calc(100vh - 70px); margin-top: 70px; perspective: 1000px; }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 20px 40px; opacity: 0; transform: scale(0.98); transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out; visibility: hidden; }
        .slide.active { opacity: 1; transform: scale(1); visibility: visible; z-index: 1; }
        .slide-content-card { max-width: 1200px; width: 100%; background: var(--card-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--card-border); border-radius: 20px; box-shadow: 0 15px 50px var(--shadow-color); overflow: auto; max-height: calc(100vh - 120px); padding: 40px 50px; }
        .slide-indicator { position: fixed; bottom: 20px; right: 30px; background: var(--heading-color); color: white; padding: 8px 15px; border-radius: 20px; font-family: 'Poppins', sans-serif; font-size: 0.9rem; z-index: 1001; }
        .section-title { font-family: 'Poppins', sans-serif; font-size: 2.2rem; font-weight: 600; color: var(--heading-color); margin-bottom: 30px; text-align: center; }
        .cost-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; margin-top: 20px; }
        .cost-table th, .cost-table td { padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .cost-table thead { background-color: rgba(244,247,254, 0.9); }
        .cost-table th { font-family: 'Poppins', sans-serif; color: var(--secondary-color); }
        .cost-table .cost { font-weight: 600; font-family: 'Poppins', sans-serif; color: var(--heading-color); text-align: right; }
        
        .calculator-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 25px; align-items: flex-start; } 
        .input-column { display: flex; flex-direction: column; gap: 25px; }
        .input-group { background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.07); }
        .input-group h3 { display: flex; align-items: center; gap: 10px; font-family: 'Poppins', sans-serif; font-size: 1.3rem; margin-bottom: 20px; }
        #dept-selection-group { border-left: 5px solid #f59e0b; }
        #dept-selection-group h3 { color: #f59e0b; }
        #structure-group { border-left: 5px solid var(--primary-color); }
        #structure-group h3 { color: var(--primary-color); }
        #volume-group { border-left: 5px solid var(--accent-color); }
        #volume-group h3 { color: var(--accent-color); }
        #usage-group { border-left: 5px solid var(--secondary-color); }
        #usage-group h3 { color: var(--secondary-color); }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .grid-span-2 { grid-column: 1 / -1; }
        .calc-input { display: flex; flex-direction: column; }
        .calc-input label { font-size: 0.9rem; font-weight: 500; color: var(--secondary-color); margin-bottom: 5px; display: flex; align-items: center; }
        .calc-input input { padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 1rem; width: 100%; box-shadow: inset 0 2px 4px rgba(0,0,0,0.06); transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        .calc-input input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); outline: none; }
        .calc-output { display: flex; flex-direction: column; }
        .calc-output span { background-color: #eef2ff; font-weight: 600; color: var(--heading-color); padding: 10px; border: 1px solid #dbeafe; border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 1rem; width: 100%; text-align: right; }
        .input-with-unit { position: relative; }
        .input-with-unit::after { content: attr(data-unit); position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #aaa; pointer-events: none; font-size: 0.9rem; }
        .number-input-stepper { position: relative; }
        .number-input-stepper .stepper-buttons { position: absolute; right: 4px; top: 4px; bottom: 4px; display: flex; flex-direction: column; }
        .number-input-stepper button { flex: 1; border: none; background: #f0f2f5; color: #555; cursor: pointer; width: 22px; font-size: 0.6rem; display: flex; align-items: center; justify-content: center; transition: background 0.2s ease; }
        .number-input-stepper button:hover { background: #e2e8f0; }
        .number-input-stepper button.stepper-up { border-radius: 4px 4px 0 0; border-bottom: 1px solid #fff; }
        .number-input-stepper button.stepper-down { border-radius: 0 0 4px 4px; }
        .number-input-stepper input { padding-right: 30px; text-align: right; }
        .input-with-unit .number-input-stepper input { padding-right: 80px; }
        .dept-checklist-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; background-color: #f7f9fc; padding: 15px; border-radius: 8px; }
        .dept-checklist-container label { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }
        .dept-checklist-container input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--primary-color); }
        .dept-selection-actions { display: flex; gap: 10px; margin-top: 15px; }
        .dept-selection-actions button { flex: 1; padding: 8px; border: 1px solid #dbeafe; background-color: #eef2ff; color: var(--primary-color); font-weight: 500; border-radius: 6px; cursor: pointer; transition: background-color 0.2s ease; }
        .dept-selection-actions button:hover { background-color: #dbeafe; }
        .calculator-outputs { margin-top: 25px; padding: 20px; background-color: #f7f9fc; border-radius: 15px; border: 1px solid #e2e8f0; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .calculator-outputs h4 { grid-column: 1 / -1; font-family: 'Poppins', sans-serif; color: var(--heading-color); margin-bottom: -5px; border-bottom: 2px solid var(--primary-color); padding-bottom: 5px; display: inline-block; }
        #calculate-btn { margin-top: 20px; width: 100%; padding: 15px; border: none; border-radius: 8px; background: var(--primary-gradient); color: white; font-family: 'Poppins', sans-serif; font-size: 1.1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; }
        #calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px var(--shadow-color); }
        .cost-table .main-row td { font-weight: bold; background-color: #f8fafc; color: var(--heading-color); }
        .cost-table .sub-row td { padding-left: 40px; color: var(--text-color); }
        .cost-table .sub-row td:first-child::before { content: "↳"; margin-right: 10px; color: #9ca3af; }
        .cost-table .free-tier-credit { color: var(--free-tier-color); }
        .cost-table .net-cost-row td { border-top: 1px solid #e2e8f0; font-weight: bold; background-color: #f8fafc; }
        .cost-table .grand-total-row td { background: var(--secondary-color); color: white; font-size: 1.2rem; font-weight: bold; font-family: 'Poppins', sans-serif; }
        .summary-card { text-align: center; background: #fff; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px var(--shadow-color); }
        .total-annual-budget { padding: 30px; border-radius: 15px; background: var(--primary-gradient); color: white; text-align: center; margin-bottom: 30px; }
        .total-annual-budget .label { font-size: 1.5rem; opacity: 0.9; font-family: 'Poppins', sans-serif; }
        .total-annual-budget .value { font-family: 'Poppins', sans-serif; font-size: 4rem; font-weight: 700; color: white; line-height: 1.2; }
        .breakdown-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .breakdown-item { background: #f7f9fc; padding: 20px; border-radius: 12px; text-align: center; }
        .breakdown-item .label { font-size: 0.9rem; font-weight: 500; color: var(--secondary-color); margin-bottom: 5px; }
        .breakdown-item .value { font-family: 'Poppins', sans-serif; font-size: 1.75rem; font-weight: 600; color: var(--heading-color); }
        .formula { font-size: 0.8rem; font-style: italic; color: #6b7280; margin-top: 4px; }
        .formula-breakdown { font-size: 0.75rem; color: #9ca3af; margin-left: 10px; line-height: 1.3; }
        .formula-breakdown::before { content: "↳ "; }
        .tooltip-container { position: relative; display: inline-flex; align-items: center; }
        .info-icon { display: inline-block; width: 18px; height: 18px; border-radius: 50%; background-color: #94a3b8; color: white; text-align: center; font-size: 13px; font-style: normal; font-weight: bold; line-height: 18px; cursor: help; margin-left: 8px; transition: background-color 0.2s; }
        .tooltip-container:hover .info-icon { background-color: var(--secondary-color); }
        .tooltip-content { visibility: hidden; opacity: 0; position: absolute; bottom: 140%; left: 50%; transform: translateX(-50%); background-color: #374151; color: #fff; padding: 10px 15px; border-radius: 8px; width: 300px; font-size: 0.85rem; font-style: normal; line-height: 1.6; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: opacity 0.3s, visibility 0.3s; z-index: 10; }
        .tooltip-content .tip { font-style: italic; color: #d1d5db; border-top: 1px solid #4b5563; margin-top: 8px; padding-top: 8px; }
        .tooltip-content::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #374151 transparent transparent transparent; }
        .tooltip-container:hover .tooltip-content { visibility: visible; opacity: 1; }

        .continue-button {
            display: inline-block;
            margin-top: 40px;
            padding: 12px 24px;
            background: var(--primary-gradient);
            color: white;
            text-decoration: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            border-radius: 25px;
            box-shadow: 0 8px 15px var(--shadow-color);
            transition: all 0.3s ease;
        }
        .continue-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(102, 126, 234, 0.4);
        }

        /* --- RESPONSIVE DESIGN STYLES --- */
        @media (max-width: 1024px) {
            .slide-content-card { padding: 30px; }
            .nav-links { gap: 25px; }
        }

        @media (max-width: 768px) {
            body { height: auto; overflow-y: auto; -webkit-overflow-scrolling: touch; }
            .navbar { height: auto; padding: 10px 15px; flex-direction: column; }
            .nav-links { margin-top: 10px; flex-wrap: wrap; justify-content: center; gap: 10px 20px; }
            .nav-links a { font-size: 0.9rem; }
            .slides-container { margin-top: 110px; height: auto; perspective: none; }
            .slide { position: relative; height: auto; opacity: 1; transform: none; visibility: visible; display: block; padding: 15px; margin-bottom: 30px; }
            .slide:not(.active) { display: none; }
            .slide-content-card { padding: 20px; max-height: none; }
            .slide-indicator { display: none; }
            .calculator-layout, .breakdown-grid, .summary-grid { grid-template-columns: 1fr; }
            .section-title { font-size: 1.7rem; }
            .total-annual-budget .value { font-size: 2.8rem; }
            .breakdown-item .value { font-size: 1.5rem; }
        }

    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="nav-logo">ISC Digitalization Budget</a>
        <ul class="nav-links">
            <li><a href="index.html">1. Executive Summary</a></li>
            <li><a href="02_Trial_Project_SCM.html">2. Trial Project (SCM)</a></li>
            <li><a href="03_Company_Rollout.html" class="active">3. Company-Wide Rollout</a></li>
            <li><a href="04_AI_Tools_Budget.html">4. AI & Productivity Tools</a></li>
        </ul>
    </nav>

    <div class="slides-container">
        <div class="slide active">
            <div class="slide-content-card">
                <h2 class="section-title">Company-Wide Rollout Assumptions</h2>
                <div class="calculator-layout">
                    <div class="input-column">
                        <div class="input-group" id="dept-selection-group">
                            <h3>🏢 Department Selection</h3>
                            <div id="dept-checklist" class="dept-checklist-container">
                                <label><input type="checkbox" class="dept-checkbox" value="SCM" checked> Supply Chain</label>
                                <label><input type="checkbox" class="dept-checkbox" value="CS" checked> Customer Service</label>
                                <label><input type="checkbox" class="dept-checkbox" value="R&D" checked> R&D</label>
                                <label><input type="checkbox" class="dept-checkbox" value="Paints" checked> Paints</label>
                                <label><input type="checkbox" class="dept-checkbox" value="Finance" checked> Finance</label>
                                <label><input type="checkbox" class="dept-checkbox" value="HR" checked> Human Resources</label>
                                <label><input type="checkbox" class="dept-checkbox" value="MP" checked> Master Plan</label>
                                <label><input type="checkbox" class="dept-checkbox" value="QA" checked> Quality Assurance</label>
                                <label><input type="checkbox" class="dept-checkbox" value="Prod" checked> Production</label>
                                <label><input type="checkbox" class="dept-checkbox" value="BoD" checked> Board of Director</label>
                            </div>
                            <div class="dept-selection-actions">
                                <button id="select-all-depts">Select All</button>
                                <button id="deselect-all-depts">Deselect All</button>
                            </div>
                        </div>
                    </div>
                    <div class="input-column">
                         <div class="input-group" id="structure-group">
                            <h3>🧬 Avg. Data Structure / Dept.</h3>
                            <div class="input-grid">
                                <div class="calc-input">
                                    <label>Tables / Dept.
                                        <div class="tooltip-container">
                                            <span class="info-icon">i</span>
                                            <div class="tooltip-content">The average number of distinct data tables each department will manage.<div class="tip">Typical: 5-20</div></div>
                                        </div>
                                    </label>
                                    <div class="input-with-unit" data-unit="Tables"><div class="number-input-stepper"><input type="text" id="tables-per-dept" value="15" data-step="1"><div class="stepper-buttons"><button class="stepper-up">▲</button><button class="stepper-down">▼</button></div></div></div>
                                </div>
                                <div class="calc-input">
                                    <label>Avg. Columns
                                        <div class="tooltip-container">
                                            <span class="info-icon">i</span>
                                            <div class="tooltip-content">The average number of columns or fields across all tables.<div class="tip">Typical: 10-30</div></div>
                                        </div>
                                    </label>
                                     <div class="input-with-unit" data-unit="Cols"><div class="number-input-stepper"><input type="text" id="num-cols" value="15" data-step="1"><div class="stepper-buttons"><button class="stepper-up">▲</button><button class="stepper-down">▼</button></div></div></div>
                                </div>
                            </div>
                        </div>
                         <div class="input-group" id="volume-group">
                            <h3>📦 Avg. Data Volume / Table</h3>
                            <div class="input-grid">
                                <div class="calc-input grid-span-2">
                                    <label>Avg. Initial Rows / Table
                                        <div class="tooltip-container">
                                            <span class="info-icon">i</span>
                                            <div class="tooltip-content">The average number of existing or historical records that will be loaded into each table at the start.<div class="tip">Typical: 1,000 - 50,000</div></div>
                                        </div>
                                    </label>
                                    <div class="input-with-unit" data-unit="Rows"><div class="number-input-stepper"><input type="text" id="avg-initial-rows" value="20,000" data-step="1000"><div class="stepper-buttons"><button class="stepper-up">▲</button><button class="stepper-down">▼</button></div></div></div>
                                </div>
                                 <div class="calc-input grid-span-2">
                                    <label>Avg. New Rows / Table / Month
                                        <div class="tooltip-container">
                                            <span class="info-icon">i</span>
                                            <div class="tooltip-content">The average number of new records that will be added to each table per month.<div class="tip">Typical: 100 - 5,000</div></div>
                                        </div>
                                    </label>
                                    <div class="input-with-unit" data-unit="Rows"><div class="number-input-stepper"><input type="text" id="avg-monthly-growth-rows" value="1,000" data-step="100"><div class="stepper-buttons"><button class="stepper-up">▲</button><button class="stepper-down">▼</button></div></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-column">
                        <div class="input-group" id="usage-group">
                            <h3>📈 Usage Pattern Breakdown</h3>
                            <h4 class="font-bold text-gray-700">Automated Generation Scans
                                <div class="tooltip-container">
                                    <span class="info-icon">i</span>
                                    <div class="tooltip-content">This represents the heavy 'Generate New Purchase Requests' workflow. We model its cost as scanning 100% of the total data size for each run.<div class="tip">Typical: 1-10 scans/day</div></div>
                                </div>
                            </h4>
                            <div class="input-grid">
                                <div class="calc-input"><label>Scans / Day</label><input type="number" id="gen-scans-per-day" value="8" min="0"></div>
                                <div class="calc-input"><label>Work Days / Month</label><input type="number" id="work-days" value="26" min="0"></div>
                            </div>
                            <h4 class="font-bold text-gray-700 mt-4">Manual User Queries
                                <div class="tooltip-container">
                                    <span class="info-icon">i</span>
                                    <div class="tooltip-content">Represents daily ad-hoc lookups by your team. We model each query as scanning 10% of the total data size.<div class="tip">Typical: 5-50 queries/user/day</div></div>
                                </div>
                            </h4>
                            <div class="input-grid">
                                <div class="calc-input"><label>Queries / User / Day</label><input type="number" id="manual-queries-per-user" value="30" min="0"></div>
                                <div class="calc-input"><label>Active Users (PICs)</label><input type="number" id="active-users" value="30" min="0"></div>
                            </div>
                            <h4 class="font-bold text-gray-700 mt-4">Data Synchronization (MERGE)
                                <div class="tooltip-container">
                                    <span class="info-icon">i</span>
                                    <div class="tooltip-content">This represents the 'Push Data' action. BigQuery treats MERGE as a query, scanning the table to find rows to update. We model this as a 100% scan of the total data size.<div class="tip">Typical: 2-10 pushes/day</div></div>
                                </div>
                            </h4>
                            <div class="input-grid">
                                <div class="calc-input grid-span-2"><label>Pushes / Day</label><input type="number" id="syncs-per-day" value="15" min="0"></div>
                            </div>
                            <div class="mt-6 pt-4 border-t">
                                <div class="calc-output"><label>Total Data Scanned / Month</label><span id="total-scanned-data-live">0.00 TB</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                 <div class="calculator-outputs">
                    <h4>Live Rollout Calculations</h4>
                    <div class="calc-output"><label>Selected Departments</label><span id="selected-dept-count">1</span><div class="formula">A direct count of checked boxes</div></div>
                    <div class="calc-output"><label>Total Data Size (Month 1)</label><span id="total-data-size-gb">0.23 GB</span><div class="formula" id="total-data-size-formula">(Initial + Growth)</div><div class="formula-breakdown" id="initial-size-breakdown"></div><div class="formula-breakdown" id="growth-size-breakdown"></div></div>
                    <div class="calc-output"><label>Est. Monthly Data Scanned</label><span id="calculated-scanned-gb">0.04 GB</span><div class="formula" id="scanned-gb-formula">(From Usage Pattern Breakdown)</div></div>
                 </div>
                 <button id="calculate-btn"><span class="btn-text">View Detailed Cost Breakdown</span></button>
            </div>
        </div>

        <div class="slide">
             <div class="slide-content-card">
                <h2 class="section-title">🚀 One-Time Onboarding Cost (Total)</h2>
                <table class="cost-table">
                    <thead><tr><th>Item</th><th>Description</th><th>Estimated Cost</th></tr></thead>
                    <tbody>
                        <tr>
                            <td><strong>BigQuery Data Ingestion</strong></td>
                            <td>Cost to load initial dataset for <strong id="onboarding-dept-count">1</strong> selected department(s). <br>
                                <span class="formula" id="onboarding-rows-formula">20,000 rows/table × 15 tables/dept × 1 depts = 300,000 total rows</span>
                            </td>
                            <td class="cost" id="onboarding-cost">$0.00</td>
                        </tr>
                        <tr style="background-color: #e6f7f2;"><td colspan="3" style="text-align:center; font-weight:bold; color: var(--free-tier-color);">Data Ingesting is free of charge on Google Cloud.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="slide">
            <div class="slide-content-card">
                <h2 class="section-title">💡 Estimated Monthly Platform Cost (Total)</h2>
                <p style="text-align: center; margin-top: -20px; margin-bottom: 30px;">The formulas below reflect the exact calculations used to determine the net costs.</p>
                <table class="cost-table">
                    <thead><tr><th>Item</th><th style="width: 35%;">Calculation</th><th>Cost</th></tr></thead>
                    <tbody>
                        <tr class="main-row"><td colspan="3">Data Storage</td></tr>
                        <tr class="sub-row"><td>Gross Storage Cost</td><td id="storage-gross-calc">(...)</td><td class="cost" id="storage-gross-cost">$0.00</td></tr>
                        <tr class="sub-row"><td>Free Tier Credit (10 GB)</td><td id="storage-free-calc">(...)</td><td class="cost free-tier-credit" id="storage-free-credit">-$0.00</td></tr>
                        <tr class="net-cost-row"><td colspan="2">Net Storage Cost</td><td class="cost" id="storage-net-cost">$0.00</td></tr>
                        <tr class="main-row" style="border-top: 2px solid var(--primary-color);"><td colspan="3">Data Analysis (Queries)</td></tr>
                        <tr class="sub-row"><td>Gross Query Cost</td><td id="query-gross-calc">(...)</td><td class="cost" id="query-gross-cost">$0.00</td></tr>
                        <tr class="sub-row"><td>Free Tier Credit (1 TB)</td><td id="query-free-calc">(...)</td><td class="cost free-tier-credit" id="query-free-credit">-$0.00</td></tr>
                        <tr class="net-cost-row"><td colspan="2">Net Analysis Cost</td><td class="cost" id="query-net-cost">$0.00</td></tr>
                        <tr class="grand-total-row"><td colspan="2">Total Estimated Recurring Monthly Cost</td><td class="cost" id="total-monthly-cost">$0.00</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="slide">
             <div class="slide-content-card">
                <h2 class="section-title">📊 Financial Summary (Company Rollout)</h2>
                <div class="summary-card">
                    <div class="total-annual-budget">
                        <div class="label">Total Annual Budget Request (2026)</div>
                        <div class="value" data-final-value="0" id="summary-total-annual-cost">$0.00</div>
                    </div>
                    <p style="text-align: center; margin: -15px 0 25px; color: #6b7280;">This total budget is for the <strong id="summary-dept-count" style="color: var(--heading-color)">10</strong> selected department(s).</p>
                    <div class="breakdown-grid">
                         <div class="breakdown-item">
                            <div class="label">Total Estimated Monthly Cost</div>
                            <div class="value" data-final-value="0" id="summary-monthly-cost">$0.00</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="label">Est. Cost per Department / Month</div>
                            <div class="value" data-final-value="0" id="summary-cost-per-dept">$0.00</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="label">Est. Cost per User / Month</div>
                            <div class="value" data-final-value="0" id="summary-cost-per-user">$0.00</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="label">Est. Cost per Work Day</div>
                            <div class="value" data-final-value="0" id="summary-cost-per-day">$0.00</div>
                        </div>
                    </div>
                    <a href="04_AI_Tools_Budget.html" class="continue-button">Continue to AI & Productivity Tools &rarr;</a>
                </div>
             </div>
        </div>
    </div>
    
    <div class="slide-indicator"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Guided Path Navigation Setup
            const pages = [
                'index.html',
                '02_Trial_Project_SCM.html',
                '03_Company_Rollout.html',
                '04_AI_Tools_Budget.html'
            ];
            const pathParts = window.location.pathname.split('/');
            const currentPageName = pathParts.pop() || 'index.html';
            const currentPageIndex = pages.findIndex(p => p.includes(currentPageName));

            // Slide Navigation
            const slides = document.querySelectorAll('.slide');
            const indicator = document.querySelector('.slide-indicator');
            const calculateBtn = document.getElementById('calculate-btn');
            let currentSlide = 0; 
            let isNavigating = false; 
            const navigationTimeout = 600;

            const parseFormattedNumber = (str) => parseFloat(String(str).replace(/,/g, '')) || 0;
            const formatWithCommas = (num, decimals = 0) => num.toLocaleString('en-US', {minimumFractionDigits: decimals, maximumFractionDigits: decimals});
            const formatCurrency = (num) => `$${num.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            function formatInput(el) { 
                el.value = formatWithCommas(parseFormattedNumber(el.value)); 
            }

            function updateAllCalculations() {
                // ... (All of the original calculator logic is preserved here)
                const selectedDeptCount = document.querySelectorAll('.dept-checkbox:checked').length;
                const tablesPerDept = parseFormattedNumber(document.getElementById('tables-per-dept').value);
                const numCols = parseFormattedNumber(document.getElementById('num-cols').value);
                const avgInitialRowsPerTable = parseFormattedNumber(document.getElementById('avg-initial-rows').value);
                const avgMonthlyGrowthRowsPerTable = parseFormattedNumber(document.getElementById('avg-monthly-growth-rows').value);
                const totalInitialRows = avgInitialRowsPerTable * tablesPerDept * selectedDeptCount;
                const totalMonthlyGrowthRows = avgMonthlyGrowthRowsPerTable * tablesPerDept * selectedDeptCount;
                const AVG_BYTES_PER_CELL = 50;
                const calculatedRowSizeBytes = numCols * AVG_BYTES_PER_CELL;
                const initialStorageGB = (totalInitialRows * calculatedRowSizeBytes) / (1024**3);
                const monthlyGrowthGB = (totalMonthlyGrowthRows * calculatedRowSizeBytes) / (1024**3);
                const totalMonthlyStorageGB = initialStorageGB + monthlyGrowthGB;
                const genScansPerDay = parseFormattedNumber(document.getElementById('gen-scans-per-day').value);
                const workDays = parseFormattedNumber(document.getElementById('work-days').value);
                const manualQueriesPerUser = parseFormattedNumber(document.getElementById('manual-queries-per-user').value);
                const activeUsers = parseFormattedNumber(document.getElementById('active-users').value);
                const syncsPerDay = parseFormattedNumber(document.getElementById('syncs-per-day').value);
                const generationGB = (genScansPerDay * workDays) * totalMonthlyStorageGB * 1.0;
                const manualQueriesGB = (manualQueriesPerUser * activeUsers * workDays) * totalMonthlyStorageGB * 0.1;
                const syncGB = (syncsPerDay * workDays) * totalMonthlyStorageGB * 1.0;
                const monthlyQueriesGB = generationGB + manualQueriesGB + syncGB;
                const monthlyQueriesTB = monthlyQueriesGB / 1024;
                const STORAGE_PRICE_PER_GB_MONTH = 0.02;
                const QUERY_PRICE_PER_TB = 6.25;
                const FREE_STORAGE_GB = 10;
                const FREE_QUERY_TB = 1;
                const grossStorageCost = totalMonthlyStorageGB * STORAGE_PRICE_PER_GB_MONTH;
                const storageFreeTierCredit = Math.min(totalMonthlyStorageGB, FREE_STORAGE_GB) * STORAGE_PRICE_PER_GB_MONTH;
                const netStorageCost = Math.max(0, grossStorageCost - storageFreeTierCredit);
                const grossQueryCost = monthlyQueriesTB * QUERY_PRICE_PER_TB;
                const queryFreeTierCredit = Math.min(monthlyQueriesTB, FREE_QUERY_TB) * QUERY_PRICE_PER_TB;
                const netQueryCost = Math.max(0, grossQueryCost - queryFreeTierCredit);
                const onboardingCost = 0;
                const totalMonthlyPlatformCost = netStorageCost + netQueryCost;
                
                document.getElementById('selected-dept-count').textContent = formatWithCommas(selectedDeptCount);
                document.getElementById('total-data-size-gb').textContent = `${totalMonthlyStorageGB.toFixed(4)} GB`;
                document.getElementById('total-data-size-formula').textContent = `(${initialStorageGB.toFixed(4)} GB + ${monthlyGrowthGB.toFixed(4)} GB)`;
                document.getElementById('initial-size-breakdown').textContent = `Initial: (${formatWithCommas(avgInitialRowsPerTable)} rows × ${formatWithCommas(tablesPerDept)} tbls × ${selectedDeptCount} depts) × ${calculatedRowSizeBytes.toFixed(0)} B/row`;
                document.getElementById('growth-size-breakdown').textContent = `Growth: (${formatWithCommas(avgMonthlyGrowthRowsPerTable)} rows × ${formatWithCommas(tablesPerDept)} tbls × ${selectedDeptCount} depts) × ${calculatedRowSizeBytes.toFixed(0)} B/row`;
                document.getElementById('total-scanned-data-live').textContent = monthlyQueriesTB < 1 ? `${monthlyQueriesGB.toFixed(2)} GB` : `${monthlyQueriesTB.toFixed(2)} TB`;
                document.getElementById('calculated-scanned-gb').textContent = monthlyQueriesTB < 1 ? `${monthlyQueriesGB.toFixed(2)} GB` : `${monthlyQueriesTB.toFixed(2)} TB`;
                document.getElementById('onboarding-dept-count').textContent = formatWithCommas(selectedDeptCount);
                document.getElementById('onboarding-rows-formula').textContent = `${formatWithCommas(avgInitialRowsPerTable)} rows/tbl × ${formatWithCommas(tablesPerDept)} tbls/dept × ${selectedDeptCount} depts = ${formatWithCommas(totalInitialRows)} total rows`;
                document.getElementById('onboarding-cost').textContent = formatCurrency(onboardingCost);
                document.getElementById('storage-gross-calc').textContent = `(${totalMonthlyStorageGB.toFixed(4)} GB * ${formatCurrency(STORAGE_PRICE_PER_GB_MONTH)}/GB)`;
                document.getElementById('storage-gross-cost').textContent = formatCurrency(grossStorageCost);
                document.getElementById('storage-free-calc').textContent = `(${Math.min(totalMonthlyStorageGB, FREE_STORAGE_GB).toFixed(4)} of ${FREE_STORAGE_GB} GB free)`;
                document.getElementById('storage-free-credit').textContent = `-${formatCurrency(storageFreeTierCredit)}`;
                document.getElementById('storage-net-cost').textContent = formatCurrency(netStorageCost);
                document.getElementById('query-gross-calc').textContent = `(${monthlyQueriesTB.toFixed(5)} TB * ${formatCurrency(QUERY_PRICE_PER_TB)}/TB)`;
                document.getElementById('query-gross-cost').textContent = formatCurrency(grossQueryCost);
                document.getElementById('query-free-calc').textContent = `(${Math.min(monthlyQueriesTB, FREE_QUERY_TB).toFixed(5)} of ${FREE_QUERY_TB} TB free)`;
                document.getElementById('query-free-credit').textContent = `-${formatCurrency(queryFreeTierCredit)}`;
                document.getElementById('query-net-cost').textContent = formatCurrency(netQueryCost);
                document.getElementById('total-monthly-cost').textContent = formatCurrency(totalMonthlyPlatformCost);
                document.getElementById('summary-dept-count').textContent = formatWithCommas(selectedDeptCount);
                const totalAnnualCost = totalMonthlyPlatformCost * 12;
                const costPerDept = selectedDeptCount > 0 ? totalMonthlyPlatformCost / selectedDeptCount : 0;
                const costPerUser = activeUsers > 0 ? totalMonthlyPlatformCost / activeUsers : 0;
                const costPerDay = workDays > 0 ? totalMonthlyPlatformCost / workDays : 0;
                document.getElementById('summary-total-annual-cost').dataset.finalValue = totalAnnualCost;
                document.getElementById('summary-monthly-cost').dataset.finalValue = totalMonthlyPlatformCost;
                document.getElementById('summary-cost-per-dept').dataset.finalValue = costPerDept;
                document.getElementById('summary-cost-per-user').dataset.finalValue = costPerUser;
                document.getElementById('summary-cost-per-day').dataset.finalValue = costPerDay;
                localStorage.setItem('rollout_monthly_cost', totalMonthlyPlatformCost);
                localStorage.setItem('rollout_annual_cost', totalAnnualCost);
            }
            
            function animateCountUp(el) { 
                const endValue = parseFloat(el.dataset.finalValue); 
                if(isNaN(endValue)) return; 
                const duration = 1200; 
                let startTimestamp = null;
                const step = (timestamp) => { 
                    if (!startTimestamp) startTimestamp = timestamp; 
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    el.textContent = formatCurrency(progress * endValue); 
                    if (progress < 1) window.requestAnimationFrame(step); 
                }; 
                window.requestAnimationFrame(step); 
            }

            function showSlide(index) {
                slides.forEach(slide => slide.classList.remove('active'));
                slides[index].classList.add('active');
                indicator.textContent = `${index + 1} / ${slides.length}`; 
                if (index === 3) { // Summary slide is now the 4th slide (index 3)
                    updateAllCalculations(); 
                    animateCountUp(document.getElementById('summary-total-annual-cost'));
                    animateCountUp(document.getElementById('summary-monthly-cost'));
                    animateCountUp(document.getElementById('summary-cost-per-dept'));
                    animateCountUp(document.getElementById('summary-cost-per-user'));
                    animateCountUp(document.getElementById('summary-cost-per-day'));
                }
            }

            function nextSlide() {
                if (currentSlide < slides.length - 1) {
                    currentSlide++;
                    showSlide(currentSlide);
                } else {
                    if (currentPageIndex < pages.length - 1) {
                        window.location.href = pages[currentPageIndex + 1];
                    }
                }
            }
            function prevSlide() {
                if (currentSlide > 0) {
                    currentSlide--;
                    showSlide(currentSlide);
                } else {
                    if (currentPageIndex > 0) {
                        window.location.href = pages[currentPageIndex - 1];
                    }
                }
            }
            
            function handleStepper(e) {
                const button = e.target.closest('.stepper-up, .stepper-down');
                if (!button) return;
                const input = button.closest('.number-input-stepper').querySelector('input');
                const step = parseFloat(input.dataset.step) || 1;
                let value = parseFormattedNumber(input.value);
                if (button.classList.contains('stepper-up')) { 
                    value += step; 
                } else { 
                    value -= step; 
                }
                input.value = Math.max(0, value);
                formatInput(input);
                updateAllCalculations();
            }
            document.querySelector('.slide.active .slide-content-card').addEventListener('click', handleStepper);

            const allInputs = document.querySelectorAll('#dept-checklist input, .input-column input');
            allInputs.forEach(input => {
                input.addEventListener('input', (e) => { 
                    if (e.target.type !== 'checkbox') {
                        if(e.target.value.endsWith(',')) return;
                        formatInput(e.target);
                    }
                    updateAllCalculations(); 
                });
                 if (input.type !== 'checkbox') {
                    input.addEventListener('blur', (e) => {
                        formatInput(e.target);
                    });
                 }
            });

            document.getElementById('select-all-depts').addEventListener('click', () => { document.querySelectorAll('.dept-checkbox').forEach(cb => cb.checked = true); updateAllCalculations(); });
            document.getElementById('deselect-all-depts').addEventListener('click', () => { document.querySelectorAll('.dept-checkbox').forEach(cb => cb.checked = false); updateAllCalculations(); });
            
            calculateBtn.addEventListener('click', nextSlide);
            document.addEventListener('keydown', (e) => { if (document.activeElement.tagName === 'INPUT') return; if (isNavigating) return; isNavigating = true; if (e.key === 'ArrowRight' || e.key === 'ArrowDown') nextSlide(); else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide(); setTimeout(() => { isNavigating = false; }, navigationTimeout); });
            document.addEventListener('wheel', (e) => { const card = e.target.closest('.slide-content-card'); if (card && card.scrollHeight > card.clientHeight) return; if (isNavigating) return; isNavigating = true; if (e.deltaY > 0) nextSlide(); else prevSlide(); setTimeout(() => { isNavigating = false; }, navigationTimeout); }, { passive: false });
            
            showSlide(currentSlide);
            updateAllCalculations();
        });
    </script>
</body>
</html>
